<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ãƒ¢ãƒªãƒ¢ãƒªã®æ£®</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; background: #e6e6fa; padding: 0; margin: 0; }
    .container { max-width: 900px; margin: auto; background: #ffffff; padding: 20px; border-radius: 8px; min-height: 100vh; }
    .input-group input, .input-group textarea, .input-group select {
      width: 100%; padding: 10px; margin: 5px 0; font-size: 1em;
    }
    .btn {
      padding: 10px; margin-top: 10px; background: #4CAF50; color: #fff;
      border: none; cursor: pointer; width: 100%;
    }
    .post {
      border: 1px solid #ccc; padding: 10px; margin-top: 10px; border-radius: 5px;
      background: #f9f9f9; position: relative;
    }
    .username { font-weight: bold; }
    .red { color: red; }
    .delete-btn, .edit-btn, .report-btn {
      background-color: #dc3545; color: white; padding: 3px 6px;
      border: none; border-radius: 3px; cursor: pointer; margin-left: 5px;
    }
    .like-btn {
      background-color: #ff9800; color: white; padding: 3px 6px;
      border: none; border-radius: 3px; cursor: pointer;
    }
    .reply-btn {
      background-color: #007bff; color: white; padding: 5px;
      margin-top: 5px; border: none; cursor: pointer;
    }
    .image-preview { max-width: 100%; margin-top: 5px; border-radius: 4px; }
    .timestamp { font-size: 0.8em; color: #666; }
    .genre-select, .sort-select { margin-top: 10px; }
    .reply { margin-left: 20px; }
    .more-btn {
      display: block; width: 100%; padding: 10px; margin-top: 10px;
      background: #777; color: white; text-align: center; cursor: pointer;
    }
    .swipe-menu {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 70%;
      height: 100%;
      background: #fff;
      border-right: 1px solid #ccc;
      z-index: 1000;
      padding: 20px;
    }
    .swipe-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 999;
    }
    .swipe-menu.open, .swipe-overlay.open {
      display: block;
    }
    .menu-btn {
      position: fixed;
      top: 10px;
      left: 10px;
      background: #333;
      color: white;
      padding: 10px;
      border-radius: 4px;
      z-index: 1100;
      cursor: pointer;
    }

    @media screen and (max-width: 600px) {
      .btn, .more-btn {
        font-size: 0.9em;
        padding: 10px;
      }
      .container {
        padding: 10px;
      }
    }
  </style>
</head>
<body>
<div class="menu-btn" onclick="toggleSwipeMenu()">â˜° ãƒ¡ãƒ‹ãƒ¥ãƒ¼</div>
<div class="swipe-menu" id="swipeMenu">
  <h3>ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h3>
  <p><a href="#form">æŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ </a></p>
  <p><a href="#liked">ã„ã„ã­ä¸€è¦§</a></p>
  <p><a href="#posts">æŠ•ç¨¿ä¸€è¦§</a></p>
</div>
<div class="swipe-overlay" id="swipeOverlay" onclick="toggleSwipeMenu()"></div>
<div class="container">
  <h1>ãƒ¢ãƒªãƒ¢ãƒªã®æ£®</h1>
  <h5>ã€œãƒ¢ãƒªãƒ¢ãƒªã®æ£®ã¯ãƒ•ãƒªãƒ¼æ²ç¤ºæ¿ã§ã™ã€œ</h5>
 <!-- ãƒªã‚¹ãã‚“Bot -->
<div id="bot-container">
  <div id="bot-message">ã“ã‚“ã«ã¡ã¯ï¼ãƒ¢ãƒªãƒ¢ãƒªã®æ£®ã¸ã‚ˆã†ã“ãï¼ğŸƒ</div>
  <input type="text" id="bot-input" placeholder="ãƒªã‚¹ãã‚“ã«è©±ã—ã‹ã‘ã‚ˆã†ï¼" />
  <button onclick="talkToBot()">é€ä¿¡</button>
</div>

  <!-- æŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ  -->
  <div id="form" class="input-group">
    <input type="text" id="username" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼å">
    <select id="genre">
      <option value="ãƒ‹ãƒ¥ãƒ¼ã‚¹">ãƒ‹ãƒ¥ãƒ¼ã‚¹</option>
      <option value="è³ªå•">è³ªå•</option>
      <option value="é›‘è«‡">é›‘è«‡</option>
      <option value="ã‚¨ãƒ³ã‚¿ãƒ¡">ã‚¨ãƒ³ã‚¿ãƒ¡</option>
      <option value="å®Ÿæ³">å®Ÿæ³</option>
    </select>
    <textarea id="content" rows="3" placeholder="æŠ•ç¨¿å†…å®¹ã‚’å…¥åŠ›"></textarea>
    <input type="file" id="imageInput" accept="image/*">
    <button class="btn" onclick="addPost()">æŠ•ç¨¿</button>
  </div>
    <!-- ç®¡ç†è€…ãƒ•ã‚©ãƒ¼ãƒ  -->
  <div class="input-group">
    <input type="password" id="adminPassword" placeholder="ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
    <button class="btn" onclick="loginAdmin()">ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³</button>
  </div>

  <!-- ã‚¸ãƒ£ãƒ³ãƒ«é¸æŠãƒ»ä¸¦ã³é †ãƒ»æ¤œç´¢ -->
  <div class="genre-select">
    è¡¨ç¤ºã‚¸ãƒ£ãƒ³ãƒ«:
    <select id="filterGenre" onchange="renderPosts()">
      <option value="ã™ã¹ã¦">ã™ã¹ã¦</option>
      <option value="ãƒ‹ãƒ¥ãƒ¼ã‚¹">ãƒ‹ãƒ¥ãƒ¼ã‚¹</option>
      <option value="è³ªå•">è³ªå•</option>
      <option value="é›‘è«‡">é›‘è«‡</option>
      <option value="ã‚¨ãƒ³ã‚¿ãƒ¡">ã‚¨ãƒ³ã‚¿ãƒ¡</option>
      <option value="å®Ÿæ³">å®Ÿæ³</option>
    </select>
    ä¸¦ã³é †:
    <select id="sortOrder" onchange="renderPosts()">
      <option value="new">æ–°ã—ã„é †</option>
      <option value="old">å¤ã„é †</option>
    </select>
    <input type="text" id="searchQuery" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢" oninput="renderPosts()">
  </div>

  <!-- ã„ã„ã­ã—ãŸæŠ•ç¨¿ä¸€è¦§ -->
  <div id="liked" class="genre-select">
    <h3>â¤ï¸ ã„ã„ã­ã—ãŸæŠ•ç¨¿ä¸€è¦§</h3>
    <div id="likedPosts"></div>
  </div>

  <!-- æŠ•ç¨¿ä¸€è¦§ -->
  <div id="posts"></div>
  <div id="moreButton" class="more-btn" onclick="loadMorePosts()">ã‚‚ã£ã¨è¦‹ã‚‹</div>
</div>

<script>
  const ADMIN_PASSWORD = "admin123";
  let isAdmin = false;
  let posts = JSON.parse(localStorage.getItem("posts") || "[]");
  let likes = JSON.parse(localStorage.getItem("likes") || "[]");
  let showCount = 10;

  function toggleSwipeMenu() {
    document.getElementById("swipeMenu").classList.toggle("open");
    document.getElementById("swipeOverlay").classList.toggle("open");
  }

  function loginAdmin() {
    const pw = document.getElementById("adminPassword").value;
    if (pw === ADMIN_PASSWORD) {
      isAdmin = true;
      alert("ç®¡ç†è€…ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã—ãŸ");
      renderPosts();
    } else {
      alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™");
    }
  }

  function addPost(parentId = null) {
    const username = document.getElementById("username").value.trim();
    const content = document.getElementById("content").value.trim();
    const genre = document.getElementById("genre").value;
    const imageInput = document.getElementById("imageInput");
    const imageFile = imageInput.files[0];

    if (!username || !content) {
      alert("ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨æŠ•ç¨¿å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
      return;
    }

    const reader = new FileReader();
    reader.onload = function(e) {
      const post = {
        id: Date.now(),
        username,
        content,
        parentId,
        genre,
        replies: [],
        image: imageFile ? e.target.result : null,
        timestamp: new Date().toLocaleString(),
        owner: username,
        likedBy: [],
        reported: false,
      };

      if (parentId) {
        const parent = findPostById(parentId);
        parent.replies.push(post);
      } else {
        posts.unshift(post);
      }

      savePosts();
      document.getElementById("content").value = "";
      imageInput.value = "";
      renderPosts();
    };

    if (imageFile) {
      reader.readAsDataURL(imageFile);
    } else {
      reader.onload({ target: { result: null } });
    }
  }
  

  function findPostById(id, list = posts) {
    for (let post of list) {
      if (post.id === id) return post;
      const found = findPostById(id, post.replies);
      if (found) return found;
    }
    return null;
  }

  function deletePost(id) {
    const username = document.getElementById("username").value.trim();
    if (!username && !isAdmin) {
      alert("ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
      return;
    }

    function removePost(list) {
      return list.filter(post => {
        if (post.id === id) {
          if (post.owner === username || isAdmin) return false;
          alert("å‰Šé™¤ã§ãã¾ã›ã‚“ã€‚");
          return true;
        }
        post.replies = removePost(post.replies);
        return true;
      });
    }

    posts = removePost(posts);
    savePosts();
    renderPosts();
  }

  function reportPost(id) {
    const post = findPostById(id);
    if (post) {
      post.reported = true;
      savePosts();
      alert("æŠ•ç¨¿ã‚’é€šå ±ã—ã¾ã—ãŸã€‚");
      renderPosts();
    }
  }

  function toggleLike(id) {
    const username = document.getElementById("username").value.trim();
    if (!username) {
      alert("ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
      return;
    }

    const post = findPostById(id);
    if (!post) return;

    const index = post.likedBy.indexOf(username);
    if (index === -1) {
      post.likedBy.push(username);
      if (!likes.includes(id)) likes.push(id);
    } else {
      post.likedBy.splice(index, 1);
      likes = likes.filter(likedId => likedId !== id);
    }

    savePosts();
    renderPosts();
  }

  function editPost(id) {
    const post = findPostById(id);
    const username = document.getElementById("username").value.trim();
    if (!post || (post.owner !== username && !isAdmin)) {
      alert("ç·¨é›†ã§ãã¾ã›ã‚“ã€‚");
      return;
    }

    const newContent = prompt("æ–°ã—ã„å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š", post.content);
    if (newContent !== null && newContent.trim() !== "") {
      post.content = newContent.trim();
      savePosts();
      renderPosts();
    }
  }

  function savePosts() {
    localStorage.setItem("posts", JSON.stringify(posts));
    localStorage.setItem("likes", JSON.stringify(likes));
  }

  function loadMorePosts() {
    showCount += 10;
    renderPosts();
  }
  function renderPosts() {
    const container = document.getElementById("posts");
    container.innerHTML = "";
    const filter = document.getElementById("filterGenre").value;
    const sortOrder = document.getElementById("sortOrder").value;
    const query = document.getElementById("searchQuery").value.toLowerCase();

    let visiblePosts = posts.filter(post =>
      post.parentId === null &&
      (filter === "ã™ã¹ã¦" || post.genre === filter) &&
      (!post.reported || isAdmin) &&
      (post.content.toLowerCase().includes(query) || post.username.toLowerCase().includes(query))
    );

    if (sortOrder === "old") {
      visiblePosts = visiblePosts.reverse();
    }

    visiblePosts.slice(0, showCount).forEach(post => {
      const div = createPostElement(post);
      container.appendChild(div);
    });

    document.getElementById("moreButton").style.display = visiblePosts.length > showCount ? "block" : "none";

    renderLikedPosts();
  }

  function createPostElement(post, depth = 0) {
    const div = document.createElement("div");
    div.className = "post";
    div.style.marginLeft = `${depth * 20}px`;

    const usernameClass = isAdmin ? "username red" : "username";
    const liked = post.likedBy.includes(document.getElementById("username").value.trim());
    const likeBtn = liked ? "â¤ï¸" : "ğŸ¤";

    div.innerHTML = `
      <div>
        <span class="${usernameClass}">${post.username}</span>
        <span class="timestamp">${post.timestamp}</span>
        ${post.genre ? `<div><strong>ã‚¸ãƒ£ãƒ³ãƒ«:</strong> ${post.genre}</div>` : ""}
        <p>${post.content}</p>
        ${post.image ? `<img src="${post.image}" class="image-preview">` : ""}
        <div>
          <button class="reply-btn" onclick="replyTo(${post.id})">è¿”ä¿¡</button>
          <button class="reply-btn" onclick="toggleLike(${post.id})">${likeBtn} ${post.likedBy.length}</button>
          <button class="reply-btn" onclick="editPost(${post.id})">ç·¨é›†</button>
          <button class="reply-btn" onclick="reportPost(${post.id})">é€šå ±</button>
          <button class="delete-btn" onclick="deletePost(${post.id})">å‰Šé™¤</button>
        </div>
      </div>
    `;

    post.replies.forEach(reply => {
      if (!reply.reported || isAdmin) {
        const replyDiv = createPostElement(reply, depth + 1);
        div.appendChild(replyDiv);
      }
    });

    return div;
  }

  function renderLikedPosts() {
    const container = document.getElementById("likedPosts");
    container.innerHTML = "";

    const likedPosts = posts.flatMap(p => [p, ...p.replies])
      .filter(p => likes.includes(p.id));

    likedPosts.forEach(post => {
      const div = document.createElement("div");
      div.className = "post";
      div.innerHTML = `
        <div><strong>${post.username}</strong> (${post.timestamp})</div>
        <p>${post.content}</p>
        ${post.image ? `<img src="${post.image}" class="image-preview">` : ""}
      `;
      container.appendChild(div);
    });
  }

  renderPosts();
</script>




<!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
<p style="margin-top: 30px;">ğŸŒ³ãƒ¢ãƒªãƒ¢ãƒªã®æ£®ã®ã”åˆ©ç”¨ã¯ã”åˆ©ç”¨è€…å„ä½ã«ãŠä»»ã›ã„ãŸã—ã¾ã™ğŸŒ³</p>
<p>ç„¡æ–­è»¢è¼‰OKã€€ã‚³ãƒ”ãƒ¼OKã€€2025.5 ãƒ¢ãƒªãƒ¢ãƒªã®æ£®Â®ï¸</p>

<style>
  @media (max-width: 600px) {
    body { padding: 10px; }
    .container { padding: 10px; }
    .post { font-size: 0.9em; }
    .input-group input, .input-group textarea, .input-group select {
      font-size: 1em;
    }
    .btn, .reply-btn, .delete-btn {
      width: 100%;
      margin-top: 5px;
    }
  }

  /* ã‚¹ãƒ¯ã‚¤ãƒ—ãƒ¡ãƒ‹ãƒ¥ãƒ¼å¯¾å¿œ (åŸºæœ¬æ§‹é€ ã ã‘) */
  .swipe-menu {
    position: fixed;
    top: 0;
    left: -250px;
    width: 250px;
    height: 100%;
    background: #333;
    color: white;
    padding: 20px;
    transition: left 0.3s ease;
    z-index: 9999;
  }

  .swipe-menu.open {
    left: 0;
  }

  .swipe-menu button {
    width: 100%;
    margin-top: 10px;
  }

  .menu-toggle {
    position: fixed;
    top: 10px;
    left: 10px;
    z-index: 10000;
    background: #4CAF50;
    color: white;
    border: none;
    padding: 8px;
    border-radius: 4px;
    cursor: pointer;
  }
</style>

<!-- ã‚¹ãƒ¯ã‚¤ãƒ—ãƒ¡ãƒ‹ãƒ¥ãƒ¼HTML -->
<div class="swipe-menu" id="swipeMenu">
  <h3>ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h3>
  <button onclick="document.getElementById('username').focus()">ãƒ¦ãƒ¼ã‚¶ãƒ¼åå…¥åŠ›</button>
  <button onclick="document.getElementById('content').focus()">æŠ•ç¨¿ä½œæˆ</button>
  <button onclick="renderPosts()">æŠ•ç¨¿ä¸€è¦§è¡¨ç¤º</button>
  <button onclick="document.getElementById('filterGenre').focus()">ã‚¸ãƒ£ãƒ³ãƒ«é¸æŠ</button>
  <button onclick="document.getElementById('searchQuery').focus()">æ¤œç´¢</button>
</div>
<button class="menu-toggle" onclick="toggleSwipeMenu()">â˜°</button>

<script>
  function toggleSwipeMenu() {
    const menu = document.getElementById("swipeMenu");
    menu.classList.toggle("open");
  }

  // åˆå›ãƒ­ãƒ¼ãƒ‰æ™‚ãƒ‡ãƒ¼ã‚¿å¾©å…ƒ
  window.onload = function () {
    const stored = localStorage.getItem("posts");
    const storedLikes = localStorage.getItem("likes");
    if (stored) posts = JSON.parse(stored);
    if (storedLikes) likes = JSON.parse(storedLikes);
    renderPosts();
  };
</script>

</body>
</html>
